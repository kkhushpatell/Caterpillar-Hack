<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer & Machine Dashboard</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #0a0a0a;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #333333;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .dashboard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .section-card {
            background: #1a1a1a;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
            border: 1px solid #333333;
        }
        
        .section-header {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000000;
            padding: 15px 25px;
            text-align: center;
            font-weight: 600;
            border-radius: 10px 10px 0 0;
            margin: 0;
        }
        
        .section-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 400;
        }
        
        .section-content {
            padding: 25px;
            color: #ffffff;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #2d2d2d 0%, #404040 100%);
            color: #ffffff;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #444444;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            color: #ffffff;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333333;
        }
        
        .data-table th {
            background: #2d2d2d;
            font-weight: 600;
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
        }
        
        .data-table tr:hover {
            background: #2a2a2a;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-Available {
            background: #10b981;
        }
        
        .status-Rented {
            background: #f59e0b;
        }
        
        .status-Maintenance {
            background: #ef4444;
        }
        
        .status-unknown {
            background: #6b7280;
        }
        
        .customer-info {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #444444;
        }
        
        .customer-name {
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 8px;
        }
        
        .customer-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .search-filter {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #333333;
        }
        
        .filter-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #ffd700;
            font-size: 0.9rem;
        }
        
        .filter-group input,
        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #444444;
            border-radius: 8px;
            font-size: 0.9rem;
            background: #2d2d2d;
            color: #ffffff;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }
        
        .filter-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
        }
        
        .status-change-select {
            padding: 6px 10px;
            border: 1px solid #444444;
            border-radius: 6px;
            font-size: 0.9rem;
            background: #2d2d2d;
            color: #ffffff;
            cursor: pointer;
        }
        
        .status-change-select:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .alert-card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 4px solid;
            animation: slideIn 0.3s ease-out;
            border: 1px solid #333333;
        }
        
        .alert-critical {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #2a1a1a 0%, #3a1a1a 100%);
        }
        
        .alert-warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #2a2a1a 0%, #3a3a1a 100%);
        }
        
        .alert-info {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #1a1a2a 0%, #1a1a3a 100%);
        }
        
        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .alert-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #ffffff;
        }
        
        .alert-time {
            font-size: 0.9rem;
            color: #cccccc;
        }
        
        .alert-message {
            color: #ffffff;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .alert-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-item {
            background: rgba(45, 45, 45, 0.8);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #444444;
        }
        
        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .metric-label {
            font-size: 0.8rem;
            color: #cccccc;
            margin-top: 2px;
        }
        
        .overuse-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .overuse-critical {
            background: #ef4444;
            color: white;
        }
        
        .overuse-warning {
            background: #f59e0b;
            color: white;
        }
        
        .email-notification {
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .customer-overview-details {
            margin-top: 25px;
        }
        
        .customer-overview-details h4 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .customer-list-mini {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .customer-mini-card {
            background: #2d2d2d;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #444444;
            transition: transform 0.2s ease;
        }
        
        .customer-mini-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .customer-mini-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .customer-mini-name {
            font-weight: 600;
            color: #ffffff;
            font-size: 1rem;
        }
        
        .customer-mini-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .customer-mini-status.active {
            background: #10b981;
            color: white;
        }
        
        .customer-mini-status.inactive {
            background: #6b7280;
            color: white;
        }
        
        .customer-mini-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.9rem;
            color: #cccccc;
        }
        
        .customer-mini-details span {
            display: flex;
            justify-content: space-between;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .error {
            background: #2a1a1a;
            color: #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid #ef4444;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .customer-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>Customer & Machine Dashboard</h1>
            <p>Comprehensive overview of customers, machines, and rental status</p>
        </div>
        
                <!-- Search and Filter Section -->
        <div class="search-filter">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="status-filter">Machine Status:</label>
                    <select id="status-filter">
                        <option value="">All Statuses</option>
                        <option value="Available">Available</option>
                        <option value="Rented">Rented</option>
                        <option value="Maintenance">Maintenance</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="customer-dropdown">Select Customer:</label>
                    <select id="customer-dropdown">
                        <option value="">All Customers</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="machine-dropdown">Select Machine:</label>
                    <select id="machine-dropdown">
                        <option value="">All Machines</option>
                    </select>
                </div>
 
 
                <button class="filter-btn" onclick="applyFilters()">Apply Filters</button>
                <button class="filter-btn" onclick="clearFilters()">Clear Filters</button>
            </div>
        </div>
        
        <!-- Statistics Overview -->
        <div class="dashboard-grid">
            <div class="section-card">
                <div class="section-header">
                    <h2>📊 Dashboard Statistics</h2>
                </div>
                <div class="section-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-machines">-</div>
                            <div class="stat-label">Total Machines</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="available-machines">-</div>
                            <div class="stat-label">Available</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="rented-machines">-</div>
                            <div class="stat-label">Rented</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="maintenance-machines">-</div>
                            <div class="stat-label">Maintenance</div>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-customers">-</div>
                            <div class="stat-label">Total Customers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="active-rentals">-</div>
                            <div class="stat-label">Active Rentals</div>
                        </div>

                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <div class="section-header">
                    <h2>👥 Customer Overview</h2>
                </div>
                <div class="section-content">
                    <div id="customer-stats">
                        <div class="loading">Loading customer data...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Data Visualization Section -->
        <div class="dashboard-grid">
            <div class="section-card">
                <div class="section-header">
                    <h2>📈 Machine Status Distribution</h2>
                </div>
                <div class="section-content">
                    <canvas id="machineStatusChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <div class="section-card">
                <div class="section-header">
                    <h2>📊 Monthly Rental Trends</h2>
                </div>
                <div class="section-content">
                    <canvas id="rentalTrendsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="section-card">
                <div class="section-header">
                    <h2>💰 Revenue Analytics</h2>
                </div>
                <div class="section-content">
                    <canvas id="revenueChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Customer Details Section -->
        <div class="section-card">
            <div class="section-header">
                <h2>👤 Customer Details</h2>
            </div>
            <div class="section-content">
                <div id="customers-list">
                    <div class="loading">Loading customers...</div>
                </div>
            </div>
        </div>
        
        <!-- Machine Details Section -->
        <div class="section-card">
            <div class="section-header">
                <h2>🚜 Machine Inventory</h2>
            </div>
            <div class="section-content">
                <div id="machines-list">
                    <div class="loading">Loading machines...</div>
                </div>
            </div>
        </div>
        
        <!-- Active Rentals Section -->
        <div class="section-card">
            <div class="section-header">
                <h2>📋 Active Rentals</h2>
            </div>
            <div class="section-content">
                <div id="active-rentals-list">
                    <div class="loading">Loading active rentals...</div>
                </div>
            </div>
        </div>
        

        
        <!-- Machine Monitoring & Alerts Section -->
        <div class="section-card">
            <div class="section-header">
                <h2>⚠️ Machine Monitoring & Alerts</h2>
            </div>
            <div class="section-content">
                <div id="machine-alerts">
                    <div class="loading">Loading machine monitoring data...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let supabase;
        let allMachines = [];
        let allCustomers = [];
        let allRentals = [];
        let machineAlerts = [];
        let monitoringInterval;
        
        // Initialize Supabase
        async function initializeSupabase() {
            try {
                const { createClient } = window.supabase;
                supabase = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
                await loadDashboardData();
            } catch (error) {
                console.error('Error initializing Supabase:', error);
                showError('Failed to initialize database connection');
            }
        }
        
        // Load all dashboard data
        async function loadDashboardData() {
            try {
                await Promise.all([
                    loadMachines(),
                    loadCustomers(),
                    loadRentals(),
                    loadMachineMonitoring()
                ]);
                
                updateStatistics();
                populateDropdowns();
                displayCustomers();
                displayMachines();
                displayActiveRentals();
                displayMachineAlerts();
                createCharts();
                
                // Initialize customer overview with all customers
                updateCustomerOverview(allCustomers, allMachines);
                
                // Start monitoring interval for real-time updates
                startMonitoringInterval();
                
                // Send email notifications for critical alerts
                sendCriticalAlertEmails();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showError('Failed to load dashboard data');
            }
        }
        
        // Load machines data
        async function loadMachines() {
            try {
                const { data, error } = await supabase
                    .from('machines')
                    .select('*')
                    .order('machine_id');
                
                if (error) throw error;
                allMachines = data || [];
                console.log('Loaded machines:', data); // Debug log
            } catch (error) {
                console.error('Error loading machines:', error);
                throw error;
            }
        }
        
        // Load customers data
        async function loadCustomers() {
            try {
                const { data, error } = await supabase
                    .from('customers')
                    .select('*')
                    .order('customer_id');
                
                if (error) throw error;
                allCustomers = data || [];
            } catch (error) {
                console.error('Error loading customers:', error);
                throw error;
            }
        }
        
        // Load rentals data
        async function loadRentals() {
            try {
                const { data, error } = await supabase
                    .from('rentals')
                    .select(`
                        *,
                        machines(machine_id, serial_number),
                        customers(customer_id, name)
                    `)
                    .eq('rental_status', 'active')
                    .order('start_date');
                
                if (error) throw error;
                allRentals = data || [];
            } catch (error) {
                console.error('Error loading rentals:', error);
                throw error;
            }
        }
        

        
        // Load machine monitoring data and check for alerts
        async function loadMachineMonitoring() {
            try {
                // Fetch machines with their model specifications
                const { data: machinesWithModels, error: machinesError } = await supabase
                    .from('machines')
                    .select(`
                        *,
                        model:model_id(max_speed, threshold_hours, threshold_speed)
                    `);
                
                if (machinesError) {
                    console.warn('Could not fetch machine models, using sample data');
                    machineAlerts = createSampleMonitoringData();
                } else {
                    // Generate current usage data and check for alerts
                    machineAlerts = generateMachineAlerts(machinesWithModels || allMachines);
                }
                
                console.log('Machine alerts generated:', machineAlerts);
            } catch (error) {
                console.error('Error loading machine monitoring:', error);
                machineAlerts = createSampleMonitoringData();
            }
        }
        
        // Generate alerts based on machine usage
        function generateMachineAlerts(machines) {
            const alerts = [];
            
            machines.forEach(machine => {
                // Generate current usage data
                const currentSpeed = Math.random() * (machine.model?.max_speed || 100) * 1.5;
                const currentHours = Math.random() * (machine.model?.threshold_hours || 1000) * 1.2;
                const maxSpeed = machine.model?.max_speed || 80;
                const thresholdHours = machine.model?.threshold_hours || 800;
                const thresholdSpeed = machine.model?.threshold_speed || 90;
                
                // Check for speed violations
                if (currentSpeed > maxSpeed) {
                    alerts.push({
                        id: `speed-${machine.machine_id}`,
                        machine_id: machine.machine_id,
                        machine_name: machine.model_name || `Machine ${machine.machine_id}`,
                        alert_type: 'speed_violation',
                        severity: currentSpeed > thresholdSpeed ? 'critical' : 'warning',
                        message: `Machine ${machine.machine_id} is operating at ${currentSpeed.toFixed(1)} km/h, exceeding the maximum speed of ${maxSpeed} km/h`,
                        current_value: currentSpeed,
                        threshold_value: maxSpeed,
                        timestamp: new Date().toISOString(),
                        email_sent: false
                    });
                }
                
                // Check for hours threshold violations
                if (currentHours > thresholdHours) {
                    alerts.push({
                        id: `hours-${machine.machine_id}`,
                        machine_id: machine.machine_id,
                        machine_name: machine.model_name || `Machine ${machine.machine_id}`,
                        alert_type: 'hours_threshold',
                        severity: currentHours > thresholdHours * 1.1 ? 'critical' : 'warning',
                        message: `Machine ${machine.machine_id} has been used for ${currentHours.toFixed(1)} hours, exceeding the threshold of ${thresholdHours} hours`,
                        current_value: currentHours,
                        threshold_value: thresholdHours,
                        timestamp: new Date().toISOString(),
                        email_sent: false
                    });
                }
                
                // Check for overuse patterns
                if (currentSpeed > thresholdSpeed && currentHours > thresholdHours) {
                    alerts.push({
                        id: `overuse-${machine.machine_id}`,
                        machine_id: machine.machine_id,
                        machine_name: machine.model_name || `Machine ${machine.machine_id}`,
                        alert_type: 'overuse',
                        severity: 'critical',
                        message: `Machine ${machine.machine_id} is being overused - high speed and extended hours detected`,
                        current_speed: currentSpeed,
                        current_hours: currentHours,
                        threshold_speed: thresholdSpeed,
                        threshold_hours: thresholdHours,
                        timestamp: new Date().toISOString(),
                        email_sent: false
                    });
                }
            });
            
            return alerts;
        }
        
        // Create sample monitoring data
        function createSampleMonitoringData() {
            return [
                {
                    id: 'speed-1',
                    machine_id: 1,
                    machine_name: 'Excavator XL-2000',
                    alert_type: 'speed_violation',
                    severity: 'critical',
                    message: 'Machine 1 is operating at 95.2 km/h, exceeding the maximum speed of 80 km/h',
                    current_value: 95.2,
                    threshold_value: 80,
                    timestamp: new Date().toISOString(),
                    email_sent: false
                },
                {
                    id: 'hours-2',
                    machine_id: 2,
                    machine_name: 'Bulldozer BD-500',
                    alert_type: 'hours_threshold',
                    severity: 'warning',
                    message: 'Machine 2 has been used for 850.5 hours, exceeding the threshold of 800 hours',
                    current_value: 850.5,
                    threshold_value: 800,
                    timestamp: new Date().toISOString(),
                    email_sent: false
                },
                {
                    id: 'overuse-3',
                    machine_id: 3,
                    machine_name: 'Crane CR-1000',
                    alert_type: 'overuse',
                    severity: 'critical',
                    message: 'Machine 3 is being overused - high speed and extended hours detected',
                    current_speed: 92.1,
                    current_hours: 920.3,
                    threshold_speed: 85,
                    threshold_hours: 800,
                    timestamp: new Date().toISOString(),
                    email_sent: false
                }
            ];
        }
        

        
        // Update dashboard statistics
        function updateStatistics() {
            const totalMachines = allMachines.length;
            const availableMachines = allMachines.filter(m => m.status === 'Available').length;
            const rentedMachines = allMachines.filter(m => m.status === 'Rented').length;
            const maintenanceMachines = allMachines.filter(m => m.status === 'Maintenance').length;
            const totalCustomers = allCustomers.length;
            const activeRentals = allRentals.length;
            
            document.getElementById('total-machines').textContent = totalMachines;
            document.getElementById('available-machines').textContent = availableMachines;
            document.getElementById('rented-machines').textContent = rentedMachines;
            document.getElementById('maintenance-machines').textContent = maintenanceMachines;
            document.getElementById('total-customers').textContent = totalCustomers;
            document.getElementById('active-rentals').textContent = activeRentals;
        }
        
        // Populate dropdown lists from Supabase data
        function populateDropdowns() {
            // Populate customer dropdown
            const customerDropdown = document.getElementById('customer-dropdown');
            customerDropdown.innerHTML = '<option value="">All Customers</option>';
            
            allCustomers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.customer_id;
                option.textContent = `${customer.name} (ID: ${customer.customer_id})`;
                customerDropdown.appendChild(option);
            });
            
            // Populate machine dropdown
            const machineDropdown = document.getElementById('machine-dropdown');
            machineDropdown.innerHTML = '<option value="">All Machines</option>';
            
            allMachines.forEach(machine => {
                const option = document.createElement('option');
                option.value = machine.machine_id;
                option.textContent = `${machine.model_name || 'Machine'} ${machine.machine_id} - ${machine.status}`;
                machineDropdown.appendChild(option);
            });
        }
        
        // Display customers
        function displayCustomers() {
            const container = document.getElementById('customers-list');
            if (allCustomers.length === 0) {
                container.innerHTML = '<p>No customers found.</p>';
                return;
            }
            
            const customersHtml = allCustomers.map(customer => `
                <div class="customer-info">
                    <div class="customer-name">${customer.name || 'Unknown Customer'}</div>
                    <div class="customer-details">
                        <div><strong>ID:</strong> ${customer.customer_id}</div>
                        <div><strong>Company:</strong> ${customer.company_name || 'N/A'}</div>
                        <div><strong>Contact:</strong> ${customer.contact_number || 'N/A'}</div>
                        <div><strong>Email:</strong> ${customer.email || 'N/A'}</div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = customersHtml;
        }
        
        // Update customer overview with filtered data
        function updateCustomerOverview(filteredCustomers, filteredMachines) {
            const container = document.getElementById('customer-stats');
            
            if (filteredCustomers.length === 0) {
                container.innerHTML = '<p>No customers match the current filters.</p>';
                return;
            }
            
            // Calculate statistics for filtered customers
            const totalFilteredCustomers = filteredCustomers.length;
            const customersWithRentals = filteredCustomers.filter(customer => 
                allRentals.some(rental => rental.customer_id === customer.customer_id)
            ).length;
            
            // Get rental statistics for filtered customers
            const customerRentals = allRentals.filter(rental => 
                filteredCustomers.some(customer => customer.customer_id === rental.customer_id)
            );
            
            const activeRentalsCount = customerRentals.filter(rental => rental.rental_status === 'Active').length;
            const completedRentalsCount = customerRentals.filter(rental => rental.rental_status === 'Completed').length;
            
            // Calculate total revenue (if available in rental data)
            const totalRevenue = customerRentals.reduce((sum, rental) => {
                return sum + (rental.rental_amount || 0);
            }, 0);
            
            const overviewHtml = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${totalFilteredCustomers}</div>
                        <div class="stat-label">Filtered Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${customersWithRentals}</div>
                        <div class="stat-label">Customers with Rentals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${activeRentalsCount}</div>
                        <div class="stat-label">Active Rentals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${completedRentalsCount}</div>
                        <div class="stat-label">Completed Rentals</div>
                    </div>
                </div>
                
                <div class="customer-overview-details">
                    <h4>Customer Details:</h4>
                    <div class="customer-list-mini">
                        ${filteredCustomers.map(customer => {
                            const customerRentals = allRentals.filter(r => r.customer_id === customer.customer_id);
                            const activeRentals = customerRentals.filter(r => r.rental_status === 'Active');
                            
                            return `
                                <div class="customer-mini-card">
                                    <div class="customer-mini-header">
                                        <span class="customer-mini-name">${customer.name}</span>
                                        <span class="customer-mini-status ${activeRentals.length > 0 ? 'active' : 'inactive'}">
                                            ${activeRentals.length > 0 ? 'Active' : 'Inactive'}
                                        </span>
                                    </div>
                                    <div class="customer-mini-details">
                                        <span>ID: ${customer.customer_id}</span>
                                        <span>Rentals: ${customerRentals.length}</span>
                                        <span>Active: ${activeRentals.length}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = overviewHtml;
        }
        
        // Display machines
        function displayMachines() {
            const container = document.getElementById('machines-list');
            if (allMachines.length === 0) {
                container.innerHTML = '<p>No machines found.</p>';
                return;
            }
            
            const machinesHtml = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Machine ID</th>
                            <th>Serial Number</th>
                            <th>Model</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Capacity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allMachines.map(machine => `
                            <tr>
                                <td>${machine.machine_id || 'N/A'}</td>
                                <td>${machine.serial_number || 'N/A'}</td>
                                <td>${machine.model_name || machine.model || 'N/A'}</td>
                                <td>${machine.machine_type || machine.type || 'N/A'}</td>
                                <td>
                                    <span class="status-indicator status-${machine.status || 'unknown'}"></span>
                                    ${machine.status || 'unknown'}
                                    ${getMachineOveruseIndicator(machine.machine_id)}
                                </td>
                                <td>${machine.weight_capacity || machine.capacity || 'N/A'}</td>
                                <td>
                                    <select class="status-change-select" onchange="changeMachineStatus(${machine.machine_id}, this.value)" data-machine-id="${machine.machine_id}">
                                        <option value="">Change Status</option>
                                        <option value="Available" ${machine.status === 'Available' ? 'selected' : ''}>Available</option>
                                        <option value="Rented" ${machine.status === 'Rented' ? 'selected' : ''}>Rented</option>
                                        <option value="Maintenance" ${machine.status === 'Maintenance' ? 'selected' : ''}>Maintenance</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = machinesHtml;
        }
        
        // Display active rentals
        function displayActiveRentals() {
            const container = document.getElementById('active-rentals-list');
            if (allRentals.length === 0) {
                container.innerHTML = '<p>No active rentals found.</p>';
                return;
            }
            
            const rentalsHtml = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Rental ID</th>
                            <th>Customer</th>
                            <th>Machine</th>
                            <th>Start Date</th>
                            <th>Expected Return</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allRentals.map(rental => `
                            <tr>
                                <td>${rental.rental_id}</td>
                                <td>${rental.customers?.name || 'Unknown'}</td>
                                <td>Machine ${rental.machines?.machine_id || 'Unknown'} (${rental.machines?.serial_number || 'N/A'})</td>
                                <td>${new Date(rental.start_date).toLocaleDateString()}</td>
                                <td>${new Date(rental.expected_return_date).toLocaleDateString()}</td>
                                <td>
                                    <span class="status-indicator status-rented"></span>
                                    Active
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = rentalsHtml;
        }
        

        
        // Display machine alerts
        function displayMachineAlerts() {
            const container = document.getElementById('machine-alerts');
            if (machineAlerts.length === 0) {
                container.innerHTML = '<p>No machine alerts at this time. All machines are operating within normal parameters.</p>';
                return;
            }
            
            const alertsHtml = machineAlerts.map(alert => {
                const alertClass = `alert-${alert.severity}`;
                const timeAgo = getTimeAgo(new Date(alert.timestamp));
                
                let metricsHtml = '';
                if (alert.alert_type === 'overuse') {
                    metricsHtml = `
                        <div class="alert-metrics">
                            <div class="metric-item">
                                <div class="metric-value">${alert.current_speed.toFixed(1)}</div>
                                <div class="metric-label">Current Speed (km/h)</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${alert.current_hours.toFixed(1)}</div>
                                <div class="metric-label">Current Hours</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${alert.threshold_speed}</div>
                                <div class="metric-label">Speed Threshold</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${alert.threshold_hours}</div>
                                <div class="metric-label">Hours Threshold</div>
                            </div>
                        </div>
                    `;
                } else {
                    metricsHtml = `
                        <div class="alert-metrics">
                            <div class="metric-item">
                                <div class="metric-value">${alert.current_value.toFixed(1)}</div>
                                <div class="metric-label">Current Value</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${alert.threshold_value}</div>
                                <div class="metric-label">Threshold</div>
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="alert-card ${alertClass}">
                        <div class="alert-header">
                            <div class="alert-title">
                                ${getAlertIcon(alert.alert_type)} ${alert.machine_name}
                                <span class="overuse-indicator overuse-${alert.severity}">
                                    ${alert.severity.toUpperCase()}
                                </span>
                                ${alert.email_sent ? '<span class="email-notification">Email Sent</span>' : ''}
                            </div>
                            <div class="alert-time">${timeAgo}</div>
                        </div>
                        <div class="alert-message">${alert.message}</div>
                        ${metricsHtml}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = alertsHtml;
        }
        
        // Get alert icon based on type
        function getAlertIcon(alertType) {
            switch(alertType) {
                case 'speed_violation': return '🚗';
                case 'hours_threshold': return '⏰';
                case 'overuse': return '⚠️';
                default: return '🔔';
            }
        }
        
        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'Just now';
            if (diffInMinutes < 60) return `${diffInMinutes} minutes ago`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours} hours ago`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            return `${diffInDays} days ago`;
        }
        
        // Send email notification for critical alerts
        async function sendEmailNotification(alert) {
            if (alert.email_sent) return; // Don't send duplicate emails
            
            try {
                // Email configuration
                const emailConfig = {
                    to: 'divyanshifuloria3@gmail.com',
                    subject: `🚨 MACHINE ALERT: ${alert.severity.toUpperCase()} - ${alert.machine_name}`,
                    body: generateEmailBody(alert)
                };
                
                console.log('Sending email notification for alert:', alert);
                console.log('Email config:', emailConfig);
                
                // In a real implementation, you would integrate with an email service like:
                // - SendGrid
                // - Mailgun
                // - AWS SES
                // - SMTP server
                
                // For demonstration, we'll simulate the email sending
                await simulateEmailSending(emailConfig);
                
                // Mark email as sent
                alert.email_sent = true;
                
                // Update the display to show email sent indicator
                displayMachineAlerts();
                
                console.log('Email notification sent successfully to:', emailConfig.to);
                
            } catch (error) {
                console.error('Error sending email notification:', error);
            }
        }
        
        // Generate email body for alerts
        function generateEmailBody(alert) {
            const timestamp = new Date(alert.timestamp).toLocaleString();
            
            let body = `
🚨 MACHINE MONITORING ALERT

Alert Type: ${alert.alert_type.replace('_', ' ').toUpperCase()}
Severity: ${alert.severity.toUpperCase()}
Machine: ${alert.machine_name} (ID: ${alert.machine_id})
Time: ${timestamp}

Message: ${alert.message}

`;

            if (alert.alert_type === 'overuse') {
                body += `
DETAILED METRICS:
- Current Speed: ${alert.current_speed.toFixed(1)} km/h
- Current Hours: ${alert.current_hours.toFixed(1)} hours
- Speed Threshold: ${alert.threshold_speed} km/h
- Hours Threshold: ${alert.threshold_hours} hours
`;
            } else {
                body += `
DETAILED METRICS:
- Current Value: ${alert.current_value.toFixed(1)}
- Threshold Value: ${alert.threshold_value}
`;
            }
            
            body += `

⚠️ IMMEDIATE ACTION REQUIRED:
Please review the machine operation and take necessary corrective measures.

---
This is an automated alert from the Machine Monitoring System.
Generated at: ${timestamp}
            `;
            
            return body;
        }
        
        // Simulate email sending (replace with actual email service integration)
        async function simulateEmailSending(emailConfig) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Log the email details (in production, this would be sent via email service)
            console.log('📧 EMAIL SENT:');
            console.log('To:', emailConfig.to);
            console.log('Subject:', emailConfig.subject);
            console.log('Body:', emailConfig.body);
            
            // You can integrate with actual email services here:
            // Example with SendGrid:
            /*
            const sgMail = require('@sendgrid/mail');
            sgMail.setApiKey(process.env.SENDGRID_API_KEY);
            
            const msg = {
                to: emailConfig.to,
                from: 'your-verified-sender@yourdomain.com',
                subject: emailConfig.subject,
                text: emailConfig.body,
                html: emailConfig.body.replace(/\n/g, '<br>')
            };
            
            await sgMail.send(msg);
            */
            
            // Example with Mailgun:
            /*
            const formData = require('form-data');
            const Mailgun = require('mailgun.js');
            const mailgun = new Mailgun(formData);
            const client = mailgun.client({username: 'api', key: process.env.MAILGUN_API_KEY});
            
            const messageData = {
                from: 'Machine Monitoring <noreply@yourdomain.com>',
                to: emailConfig.to,
                subject: emailConfig.subject,
                text: emailConfig.body
            };
            
            await client.messages.create('yourdomain.com', messageData);
            */
        }
        
        // Start monitoring interval for real-time updates
        function startMonitoringInterval() {
            // Clear existing interval if any
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
            }
            
            // Check for new alerts every 30 seconds
            monitoringInterval = setInterval(async () => {
                await loadMachineMonitoring();
                displayMachineAlerts();
                sendCriticalAlertEmails();
            }, 30000); // 30 seconds
        }
        
        // Send email notifications for critical alerts
        async function sendCriticalAlertEmails() {
            const criticalAlerts = machineAlerts.filter(alert => 
                alert.severity === 'critical' && !alert.email_sent
            );
            
            for (const alert of criticalAlerts) {
                await sendEmailNotification(alert);
            }
        }
        
        // Clean up monitoring interval when page is unloaded
        window.addEventListener('beforeunload', () => {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
            }
        });
        

        
        // Get machine overuse indicator
        function getMachineOveruseIndicator(machineId) {
            const machineAlert = machineAlerts.find(alert => alert.machine_id === machineId);
            if (machineAlert) {
                const severityClass = machineAlert.severity === 'critical' ? 'overuse-critical' : 'overuse-warning';
                return `<span class="overuse-indicator ${severityClass}">OVERUSE</span>`;
            }
            return '';
        }
        
        // Chart instances
        let machineStatusChart, rentalTrendsChart, revenueChart;
        
        // Create and update all charts
        function createCharts() {
            createMachineStatusChart();
            createRentalTrendsChart();
            createRevenueChart();
        }
        
        // Update all charts
        function updateCharts() {
            if (machineStatusChart) machineStatusChart.destroy();
            if (rentalTrendsChart) rentalTrendsChart.destroy();
            if (revenueChart) revenueChart.destroy();
            
            createCharts();
        }
        
        // Create machine status distribution chart
        function createMachineStatusChart() {
            const ctx = document.getElementById('machineStatusChart').getContext('2d');
            const availableCount = allMachines.filter(m => m.status === 'Available').length;
            const rentedCount = allMachines.filter(m => m.status === 'Rented').length;
            const maintenanceCount = allMachines.filter(m => m.status === 'Maintenance').length;
            
            machineStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Rented', 'Maintenance'],
                    datasets: [{
                        data: [availableCount, rentedCount, maintenanceCount],
                        backgroundColor: [
                            '#10b981',
                            '#ffd700',
                            '#ef4444'
                        ],
                        borderWidth: 2,
                        borderColor: '#1a1a1a'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }
        
        // Create rental trends chart
        function createRentalTrendsChart() {
            const ctx = document.getElementById('rentalTrendsChart').getContext('2d');
            
            // Generate sample monthly data
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const rentalData = months.map(() => Math.floor(Math.random() * 20) + 5);
            
            rentalTrendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Active Rentals',
                        data: rentalData,
                        borderColor: '#ffd700',
                        backgroundColor: 'rgba(255, 215, 0, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }
        

        
        // Create revenue analytics chart
        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            // Generate sample revenue data
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const revenueData = months.map(() => Math.floor(Math.random() * 50000) + 20000);
            
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Monthly Revenue ($)',
                        data: revenueData,
                        backgroundColor: 'rgba(255, 215, 0, 0.8)',
                        borderColor: '#ffd700',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }
        
        // Apply filters
        function applyFilters() {
            const statusFilter = document.getElementById('status-filter').value;
            const customerDropdown = document.getElementById('customer-dropdown').value;
            const machineDropdown = document.getElementById('machine-dropdown').value;
            
            let filteredMachines = allMachines;
            let filteredCustomers = allCustomers;
            
            // Apply status filter
            if (statusFilter) {
                filteredMachines = filteredMachines.filter(m => m.status === statusFilter);
            }
            
            // Apply customer dropdown filter
            if (customerDropdown) {
                const selectedCustomerId = parseInt(customerDropdown);
                filteredCustomers = filteredCustomers.filter(c => c.customer_id === selectedCustomerId);
                
                // Also filter machines rented by this customer
                const customerRentals = allRentals.filter(r => r.customer_id === selectedCustomerId);
                const customerMachineIds = customerRentals.map(r => r.machine_id);
                filteredMachines = filteredMachines.filter(m => customerMachineIds.includes(m.machine_id));
            }
            
            // Apply machine dropdown filter
            if (machineDropdown) {
                const selectedMachineId = parseInt(machineDropdown);
                filteredMachines = filteredMachines.filter(m => m.machine_id === selectedMachineId);
                
                // Also filter customers who have rented this machine
                const machineRentals = allRentals.filter(r => r.machine_id === selectedMachineId);
                const machineCustomerIds = machineRentals.map(r => r.customer_id);
                filteredCustomers = filteredCustomers.filter(c => machineCustomerIds.includes(c.customer_id));
            }
            
            // Text search inputs removed; filtering relies on dropdowns only
            
            // Update displays with filtered data
            displayFilteredMachines(filteredMachines);
            displayFilteredCustomers(filteredCustomers);
            updateCustomerOverview(filteredCustomers, filteredMachines);
        }
        
        // Display filtered machines
        function displayFilteredMachines(machines) {
            const container = document.getElementById('machines-list');
            if (machines.length === 0) {
                container.innerHTML = '<p>No machines match the current filters.</p>';
                return;
            }
            
            const machinesHtml = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Machine ID</th>
                            <th>Serial Number</th>
                            <th>Model</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Capacity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${machines.map(machine => `
                            <tr>
                                <td>${machine.machine_id}</td>
                                <td>${machine.serial_number || 'N/A'}</td>
                                <td>${machine.model_name || 'N/A'}</td>
                                <td>${machine.machine_type || 'N/A'}</td>
                                <td>
                                    <span class="status-indicator status-${machine.status}"></span>
                                    ${machine.status}
                                    ${getMachineOveruseIndicator(machine.machine_id)}
                                </td>
                                <td>${machine.weight_capacity || 'N/A'}</td>
                                <td>
                                    <select class="status-change-select" onchange="changeMachineStatus(${machine.machine_id}, this.value)" data-machine-id="${machine.machine_id}">
                                        <option value="">Change Status</option>
                                        <option value="Available" ${machine.status === 'Available' ? 'selected' : ''}>Available</option>
                                        <option value="Rented" ${machine.status === 'Rented' ? 'selected' : ''}>Rented</option>
                                        <option value="Maintenance" ${machine.status === 'Maintenance' ? 'selected' : ''}>Maintenance</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = machinesHtml;
        }
        
        // Display filtered customers
        function displayFilteredCustomers(customers) {
            const container = document.getElementById('customers-list');
            if (customers.length === 0) {
                container.innerHTML = '<p>No customers match the current filters.</p>';
                return;
            }
            
            const customersHtml = customers.map(customer => `
                <div class="customer-info">
                    <div class="customer-name">${customer.name || 'Unknown Customer'}</div>
                    <div class="customer-details">
                        <div><strong>ID:</strong> ${customer.customer_id}</div>
                        <div><strong>Company:</strong> ${customer.company_name || 'N/A'}</div>
                        <div><strong>Contact:</strong> ${customer.contact_number || 'N/A'}</div>
                        <div><strong>Email:</strong> ${customer.email || 'N/A'}</div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = customersHtml;
        }
        

        
        // Clear filters
        function clearFilters() {
            document.getElementById('status-filter').value = '';
            document.getElementById('customer-dropdown').value = '';
            document.getElementById('machine-dropdown').value = '';
            
            // Reset to original data
            displayCustomers();
            displayMachines();
            
            // Reset customer overview to show all customers
            updateCustomerOverview(allCustomers, allMachines);
        }
        
        // Show error message
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.dashboard-container').insertBefore(errorDiv, document.querySelector('.dashboard-grid'));
        }
        
        // Change machine status
        async function changeMachineStatus(machineId, newStatus) {
            if (!newStatus) return; // Don't update if no status selected
            
            try {
                // Update in Supabase
                const { error } = await supabase
                    .from('machines')
                    .update({ status: newStatus })
                    .eq('machine_id', machineId);
                
                if (error) {
                    console.error('Error updating machine status:', error);
                    showError('Failed to update machine status');
                    return;
                }
                
                // Update local data
                const machineIndex = allMachines.findIndex(m => m.machine_id === machineId);
                if (machineIndex !== -1) {
                    allMachines[machineIndex].status = newStatus;
                }
                
                // Update statistics and displays
                updateStatistics();
                displayMachines();
                updateCharts();
                
                // Show success message
                showSuccess(`Machine ${machineId} status updated to ${newStatus}`);
                
            } catch (error) {
                console.error('Error changing machine status:', error);
                showError('Failed to update machine status');
            }
        }
        
        // Show success message
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            successDiv.style.cssText = `
                background: #1a2a1a;
                color: #10b981;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                margin: 20px 0;
                border: 1px solid #10b981;
            `;
            document.querySelector('.dashboard-container').insertBefore(successDiv, document.querySelector('.dashboard-grid'));
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initializeSupabase);
    </script>
</body>
</html>
